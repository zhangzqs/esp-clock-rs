import { MultiPage } from "pages/index.slint";
import { BootState } from "pages/boot/index.slint";
import { HomeWeatherData, HomeTimeData } from "pages/home/index.slint";
import "fonts/microsoft-yahei.ttf";


export component AppWindow inherits Window {
    default-font-family: "Microsoft YaHei";
    width: 240px;
    height: 240px;

    in property <int> fps;
    in property <int> memory;
    in property <int> largest-free-block;
    in property <int> cpu;
    VerticalLayout {
        z: 1;
        alignment: start;
        HorizontalLayout {
            HorizontalLayout {
                alignment: start;
                Rectangle {
                    background: gray.with-alpha(0.5);
                    Text {
                        color: #ff2a00;
                        font-size: 20px;
                        text: "memory: \{memory}\n"+"free block: \{largest-free-block}";
                    }
                }
            }
            HorizontalLayout {
                alignment: end;
                Rectangle {
                    background: gray.with-alpha(0.5);
                    Text {
                        color: #ff2a00;
                        font-size: 20px;
                        text: "fps: \{fps}\n"+"cpu: \{cpu}";
                    }
                }
            }
        }
    }

    m := MultiPage{
        z: 0;
        home-page-time: home-page-time;
        home-page-weather: home-page-weather;
        photo-page-source: photo-page-source;
        photo-page-enter => { photo-page-enter(); }
        photo-page-request-next => { photo-page-request-next(); }
        photo-page-request-auto-play => { photo-page-request-auto-play(); }
        photo-page-request-stop-auto-play => { photo-page-request-stop-auto-play(); }
        photo-page-exit => { photo-page-exit(); }
    }
    // 设置启动状态
    public function set-boot-state(state: BootState) {
        m.boot-page-set-state(state);
    }

    // home页的时间和天气
    in property <HomeTimeData> home-page-time;
    in property <HomeWeatherData> home-page-weather;

    // photo页的相关属性
    in property <image> photo-page-source;
    callback photo-page-enter();
    callback photo-page-request-next();
    callback photo-page-request-auto-play();
    callback photo-page-request-stop-auto-play();
    callback photo-page-exit();
    public function photo-page-is-auto-play-mode() -> bool{
        return m.photo-page-is-auto-play-mode();
    }

    // 触发点击事件
    // count: 点击次数
    public function on-one-button-clicks(count: int) {
        debug("click count: ", count);
        if (count == 1) {
            m.on-one-button-click();
        } 
        if (count == 2) {
            m.on-one-button-double-click();
        }
        if (count == 3) {
            m.on-one-button-triple-click();
        }
    }

    // 触发长按事件
    // dur: 按下时长
    public function on-one-button-long-pressed-holding(dur: duration) {
        m.on-one-button-long-pressed-holding(dur);
    }

    // 长按后松开
    // dur: 按下总时长
    public function on-one-button-long-pressed-held(dur: duration) {
        m.on-one-button-long-pressed-held(dur);
    }
}
